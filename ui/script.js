let throttleDirection=0,throttleLimit=.5,steeringDirection=0,steeringLimit=.5,prevThrottle=0,prevSteering=0;const isLocalDocument="file:"===window.location.protocol||"content:"===window.location.protocol,isMobile=navigator.userAgentData.mobile;let isRequestInProgress=!1;function sendUpdate(){function e(e,t){return Math.round(e/t)*t}let t=Number(e(throttleDirection*throttleLimit,.05).toFixed(2)),o=Number(e(steeringDirection*steeringLimit,.05).toFixed(2));if(t===prevThrottle&&o===prevSteering||isRequestInProgress){console.log("No change or request in progress");return}{isRequestInProgress=!0;let r=new URLSearchParams;o!==prevSteering&&r.append("s",o),t!==prevThrottle&&r.append("t",t),console.log(JSON.stringify(Object.fromEntries(r.entries()))),prevThrottle=t,prevSteering=o;let i;isLocalDocument?i=document.getElementById("urlInput").value:(i=`${window.location.protocol}//${window.location.hostname}`,window.location.port&&(i+=`:${window.location.port}`)),console.log("Current URL:",i);let n=`${i}/?${r.toString()}`,l=new AbortController,s=setTimeout(()=>l.abort(),2e3);fetch(n,{signal:l.signal}).then(e=>{if(!e.ok)throw Error("Network response was not ok");return e.json()}).then(e=>{console.log(e)}).catch(e=>{"AbortError"===e.name?console.error("Fetch request timed out"):console.error("There has been a problem with your fetch operation:",e)}).finally(()=>{clearTimeout(s),isRequestInProgress=!1,sendUpdate()})}}function updateThrottleLimit(){let e=document.getElementById("throttleSlider"),t=document.getElementById("throttleLimit"),o=e.value;o=o.padStart(3," ").replace(/ /g,"\xa0")+"%",t.innerText=o,throttleLimit=e.value/100}function updateSteeringLimit(){let e=document.getElementById("steeringSlider"),t=document.getElementById("steeringLimit"),o=e.value;o=o.padStart(3," ").replace(/ /g,"\xa0")+"%",t.innerText=o,steeringLimit=e.value/100}function load(){function e(e){let t=this.querySelector('input[type="radio"]');t&&e.target!==t&&t.click()}console.log("isMobile:",isMobile),console.log("isLocalDocument:",isLocalDocument);let t=document.querySelectorAll(".radio-container");function o(e,t){let o=!0;switch(e.key){case"w":throttleDirection=t?1:0;break;case"s":throttleDirection=t?-1:0;break;case"a":steeringDirection=t?-1:0;break;case"d":steeringDirection=t?1:0;break;default:o=!1}o&&sendUpdate()}t.forEach(t=>{t.addEventListener("click",e)}),isMobile?document.querySelectorAll(".desktop").forEach(e=>e.style.display="none"):document.querySelectorAll(".mobile").forEach(e=>e.style.display="none"),isLocalDocument&&(document.getElementById("settingsDialog").showModal(),document.getElementById("urlInput").value=localStorage.getItem("url")),document.addEventListener("keydown",function(e){o(e,!0)}),document.addEventListener("keyup",function(e){o(e,!1)})}function saveUrl(){let e=document.getElementById("urlInput");localStorage.setItem("url",e.value)}function closeDialog(){document.getElementById("settingsDialog").close()}